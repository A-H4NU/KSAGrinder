<Page x:Class="KSAGrinder.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:KSAGrinder.Pages"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:valueConverters="clr-namespace:KSAGrinder.ValueConverters"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      mc:Ignorable="d" 
      d:DesignHeight="720" d:DesignWidth="1280"
      Title="MainPage" Background="White">
    <Page.Resources>
        <valueConverters:ConvertItemToIndex x:Key="IndexConverter"/>
        <valueConverters:LectureGrayingIfSelected x:Key="GrayingIfSelected"/>
        <valueConverters:BlueIfHasNote x:Key="BlueIfHasNote"/>
        <valueConverters:ScoreToColor x:Key="ScoreToColor"/>

        <!-- Timetable Styles -->
        <Style x:Key="TimetableDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="ColumnHeaderStyle" Value="{DynamicResource TimetableColumnHeaderStyle}"/>
            <Setter Property="RowHeaderStyle" Value="{DynamicResource TimetableRowHeaderStyle}"/>
            <Setter Property="CellStyle" Value="{DynamicResource TimetableDataGridCellStyle}"/>
        </Style>
        <Style x:Key="TimetableColumnHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Height" Value="30"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>
        <Style x:Key="TimetableRowHeaderStyle" TargetType="{x:Type DataGridRowHeader}">
            <Setter Property="Content" Value="{Binding Converter={StaticResource IndexConverter}}" />
            <Setter Property="Width" Value="30"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>
        <Style x:Key="TimetableDataGridCellStyle" TargetType="{x:Type DataGridCell}">
            <Setter Property="TextBlock.TextAlignment" Value="Center"/>
            <Setter Property="TextBlock.HorizontalAlignment" Value="Stretch"/>
        </Style>
        
        <!-- LectureTable Styles -->
        <Style x:Key="LectureTableDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="ColumnHeaderStyle" Value="{DynamicResource LectureTableColumnHeaderStyle}"/>
            <Setter Property="CellStyle" Value="{DynamicResource TimetableDataGridCellStyle}"/>
        </Style>
        <Style x:Key="LectureTableColumnHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Height" Value="25"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Used in MainPage.xaml.cs -->
        <Style x:Key="TextBoxStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>
        
    </Page.Resources>

    <DockPanel>
        <Menu Padding="5" FontSize="13" DockPanel.Dock="Top">
            <MenuItem Header="파일">
                <MenuItem Header="새 시간표 (Ctrl+N)" Click="MenuNewSchedule_Click"/>
                <MenuItem Header="열기 (Ctrl+O)" Click="MenuOpen_Click"/>
                <MenuItem Header="학번에서 불러오기" Click="MenuLoadID_Click"/>
                <MenuItem Header="저장 (Ctrl+S)" Click="MenuSave_Click"/>
                <MenuItem Header="다른 이름으로 저장" Click="MenuSaveAs_Click"/>
            </MenuItem>
        </Menu>
        <Grid DockPanel.Dock="Bottom">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="600" Width="3*"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>


            <DockPanel x:Name="TimetablePanel" Grid.RowSpan="2" Margin="10,0,10,10">
                <Label DockPanel.Dock="Top" Content="시간표" FontSize="22" FontWeight="SemiBold" FontStyle="Italic" HorizontalContentAlignment="Center"/>
                <DataGrid x:Name="Timetable" ColumnWidth="*"
                      Style="{DynamicResource TimetableDataGridStyle}"
                      ItemsSource="{Binding}" AutoGenerateColumns="True"
                      AlternatingRowBackground = "#F4F4F4" SelectionUnit="Cell"
                      CanUserReorderColumns="False" CanUserResizeColumns="False" CanUserSortColumns="False"
                      CanUserResizeRows="False" CanUserAddRows="False" IsReadOnly="True"
                      HorizontalScrollBarVisibility="Disabled">
                </DataGrid>
            </DockPanel>
            <DockPanel Margin="10" Grid.Column="1" Grid.Row="0">
                <DockPanel DockPanel.Dock="Top" Margin="0,15,0,10">
                    <ComboBox x:Name="CmbDepartment" Width="85.24" DockPanel.Dock="Left" FontSize="13" VerticalContentAlignment="Center" SelectedIndex="0"
                          ItemsSource="{Binding DepartmentCollection}" SelectionChanged="CmbDepartment_SelectionChanged"/>
                    <Label Content="검색: " FontSize="13" Margin="10,0,0,0"/>
                    <TextBox x:Name="TxtSearch" VerticalContentAlignment="Center" FontSize="13" TextChanged="TxtSearch_TextChanged"/>
                </DockPanel>
                <Grid Grid.Column="1" Grid.Row="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="5*"/>
                        <RowDefinition Height="3*"/>
                    </Grid.RowDefinitions>

                    <DataGrid Grid.Row="0" DockPanel.Dock="Top" x:Name="LectureTable" Margin="0,0,0,10" SelectionMode="Single" MinHeight="100"
                      Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding LectureCollection}" AutoGenerateColumns="False"
                      AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                      CanUserResizeColumns="False" CanUserAddRows="False" IsReadOnly="True" SelectionChanged="LectureTable_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="학부" Width="55" Binding="{Binding Department}"/>
                            <DataGridTextColumn Header="강의명" Width="*" Binding="{Binding Name}"/>
                            <DataGridTextColumn Header="분반 수" Width="55" Binding="{Binding NumClass}" CanUserSort="False"/>
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}">
                                <Setter Property="Foreground" Value="{Binding Code, Converter={StaticResource GrayingIfSelected}}"/>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>

                    <DataGrid Grid.Row="1" DockPanel.Dock="Bottom" x:Name="ClassTable"
                      Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding ClassCollection}" AutoGenerateColumns="False"
                      AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                      CanUserResizeColumns="False" CanUserAddRows="False" IsReadOnly="True" CanUserSortColumns="False">
                        <DataGrid.Resources>
                            <ContextMenu x:Key="RowMenu">
                                <MenuItem Header="세부 정보 보기" Click="ClassTableMenuItem_Click"/>
                            </ContextMenu>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="No." MaxWidth="30" Binding="{Binding Number}"/>
                            <DataGridTextColumn Header="선생님" MaxWidth="70" Binding="{Binding Teacher}"/>
                            <DataGridTextColumn Header="요일/시간" Width="*" Binding="{Binding DayTime}"/>
                            <DataGridTextColumn Header="신청인원" MinWidth="65" Binding="{Binding Enroll}"/>
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}">
                                <Setter Property="ContextMenu" Value="{StaticResource RowMenu}"/>
                                <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick"/>
                                <Setter Property="Foreground">
                                    <Setter.Value>
                                        <MultiBinding Converter="{StaticResource BlueIfHasNote}">
                                            <Binding Path="Code"/>
                                            <Binding Path="Number"/>
                                        </MultiBinding>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </DockPanel>

            <DataGrid x:Name="CurrentClassTable" Margin="10" Grid.Column="1" Grid.Row="1" AutoGenerateColumns="False"
                  Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding CurrentClassCollection}"
                  AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                  CanUserResizeColumns="False" CanUserAddRows="False" CanUserSortColumns="False" >
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="고정" Width="40"/>
                    <DataGridTextColumn Header="강의명" Width="*" Binding="{Binding Name}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="No." Width="40" Binding="{Binding Number}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="선생님" Width="55" Binding="{Binding Teacher}" IsReadOnly="True"/>
                </DataGrid.Columns>
                <DataGrid.Resources>
                </DataGrid.Resources>
                <DataGrid.RowStyle>
                    <Style TargetType="{x:Type DataGridRow}">
                        <EventSetter Event="MouseRightButtonUp" Handler="CurrentClassTableRow_RightClick"/>
                        <EventSetter Event="KeyDown" Handler="CurrentClassTableRow_KeyDown"/>
                    </Style>
                </DataGrid.RowStyle>

            </DataGrid>

            <DockPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="2" Margin="10">
                <DockPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                    <Label Content="선호: " FontSize="13"/>
                    <ComboBox x:Name="CmbPreference" ItemsSource="{Binding PreferenceCollection}"
                              SelectedIndex="0" VerticalContentAlignment="Center" FontSize="13"/>
                </DockPanel>
                <Grid DockPanel.Dock="Top" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="BtnGenerate" Grid.Column="0" Content="조합" Height="25" Margin="0,0,5,0" Click="BtnGenerate_Click"/>
                    <Button x:Name="BtnTrade" Grid.Column="1" Content="트레이드 생성" Height="25" Margin="5,0,0,0" Click="BtnTrade_Click"/>
                </Grid>
                
                <DataGrid x:Name="SchedulesTable" ItemsSource="{Binding ScheduleCollection}" AutoGenerateColumns="False" IsReadOnly="True"
                          Style="{StaticResource LectureTableDataGridStyle}" Margin="0,0,0,10"
                          ColumnHeaderStyle="{StaticResource LectureTableColumnHeaderStyle}" CellStyle="{StaticResource TimetableDataGridCellStyle}"
                          HeadersVisibility="Column" CanUserReorderColumns="False" >
                    <DataGrid.Columns>
                        <DataGridTextColumn Width="*" Header="1공강" Binding="{Binding Evaluate1Empty}">
                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="{Binding Evaluate1Empty, Converter={StaticResource ScoreToColor}}"/>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Width="*" Header="4공강" Binding="{Binding Evaluate4Empty}">
                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="{Binding Evaluate4Empty, Converter={StaticResource ScoreToColor}}"/>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Width="*" Header="5공강" Binding="{Binding Evaluate5Empty}">

                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="{Binding Evaluate5Empty, Converter={StaticResource ScoreToColor}}"/>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Width="*" Header="면학 종료" Binding="{Binding EvaluateCompact}">
                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="{Binding EvaluateCompact, Converter={StaticResource ScoreToColor}}"/>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Width="*" Header="분반 이동" Binding="{Binding EvaluateLowNumMoves}">
                            <DataGridTextColumn.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="{Binding EvaluateLowNumMoves, Converter={StaticResource ScoreToColor}}"/>
                                </Style>
                            </DataGridTextColumn.CellStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="{x:Type DataGridRow}">
                            <EventSetter Event="MouseDoubleClick" Handler="SchedulesTableRow_MouseDoubleClick"/>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </DockPanel>

        </Grid>
    </DockPanel>
    
</Page>
