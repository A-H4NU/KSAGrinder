<Page x:Class="KSAGrinder.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:KSAGrinder.Pages"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:valueConverters="clr-namespace:KSAGrinder.ValueConverters"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      mc:Ignorable="d" 
      d:DesignHeight="720" d:DesignWidth="1280"
      Title="MainPage" Background="White">
    <Page.Resources>
        <valueConverters:ConvertItemToIndex x:Key="IndexConverter"/>
        <valueConverters:LectureGrayingIfSelected x:Key="GrayingIfSelected"/>
        <valueConverters:BlueIfHasNote x:Key="BlueIfHasNote"/>
        <!-- Timetable Styles -->
        <Style x:Key="TimetableDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="ColumnHeaderStyle" Value="{DynamicResource TimetableColumnHeaderStyle}"/>
            <Setter Property="RowHeaderStyle" Value="{DynamicResource TimetableRowHeaderStyle}"/>
            <Setter Property="CellStyle" Value="{DynamicResource TimetableDataGridCellStyle}"/>
        </Style>
        <Style x:Key="TimetableColumnHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Height" Value="30"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>
        <Style x:Key="TimetableRowHeaderStyle" TargetType="{x:Type DataGridRowHeader}">
            <Setter Property="Content" Value="{Binding Converter={StaticResource IndexConverter}}" />
            <Setter Property="Width" Value="30"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>
        <Style x:Key="TimetableDataGridCellStyle" TargetType="{x:Type DataGridCell}">
            <Setter Property="TextBlock.TextAlignment" Value="Center"/>
            <Setter Property="TextBlock.HorizontalAlignment" Value="Stretch"/>
        </Style>
        
        <!-- LectureTable Styles -->
        <Style x:Key="LectureTableDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="ColumnHeaderStyle" Value="{DynamicResource LectureTableColumnHeaderStyle}"/>
            <Setter Property="CellStyle" Value="{DynamicResource TimetableDataGridCellStyle}"/>
        </Style>
        <Style x:Key="LectureTableColumnHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Height" Value="25"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Used in MainPage.xaml.cs -->
        <Style x:Key="TextBoxStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>
        
    </Page.Resources>

    <DockPanel>
        <Menu Padding="5" FontSize="13" DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Open" Click="BtnOpen_Click"/>
                <MenuItem Header="Load from ID" Click="BtnLoadID_Click"/>
                <MenuItem Header="Save" Click="BtnSave_Click"/>
                <MenuItem Header="Save as.." Click="BtnSaveAs_Click"/>
            </MenuItem>
        </Menu>
        <Grid DockPanel.Dock="Bottom">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="600" Width="3*"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>


            <DockPanel x:Name="TimetablePanel" Grid.RowSpan="2" Margin="10,0,10,10">
                <Label DockPanel.Dock="Top" Content="Course Schedule" FontSize="22" FontWeight="SemiBold" FontStyle="Italic" HorizontalContentAlignment="Center"/>
                <DataGrid x:Name="Timetable" ColumnWidth="*"
                      Style="{DynamicResource TimetableDataGridStyle}"
                      ItemsSource="{Binding}" AutoGenerateColumns="True"
                      AlternatingRowBackground = "#F4F4F4" SelectionUnit="Cell"
                      CanUserReorderColumns="False" CanUserResizeColumns="False" CanUserSortColumns="False"
                      CanUserResizeRows="False" CanUserAddRows="False" IsReadOnly="True"
                      HorizontalScrollBarVisibility="Disabled"/>
            </DockPanel>
            <DockPanel Margin="10" Grid.Column="1" Grid.Row="0">
                <DockPanel DockPanel.Dock="Top" Margin="0,15,0,10">
                    <ComboBox x:Name="CmbDepartment" Width="85.24" DockPanel.Dock="Left" FontSize="13" VerticalContentAlignment="Center" SelectedIndex="0"
                          ItemsSource="{Binding DepartmentCollection}" SelectionChanged="CmbDepartment_SelectionChanged"/>
                    <Label Content="Search: " FontSize="13" Margin="10,0,0,0"/>
                    <TextBox x:Name="TxtSearch" VerticalContentAlignment="Center" FontSize="13" TextChanged="TxtSearch_TextChanged"/>
                </DockPanel>
                <Grid Grid.Column="1" Grid.Row="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="5*"/>
                        <RowDefinition Height="3*"/>
                    </Grid.RowDefinitions>

                    <DataGrid Grid.Row="0" DockPanel.Dock="Top" x:Name="LectureTable" Margin="0,0,0,10" SelectionMode="Single" MinHeight="100"
                      Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding LectureCollection}" AutoGenerateColumns="False"
                      AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                      CanUserResizeColumns="False" CanUserAddRows="False" IsReadOnly="True" SelectionChanged="LectureTable_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Dep." Width="55" Binding="{Binding Department}"/>
                            <DataGridTextColumn Header="Lecture Name" Width="*" Binding="{Binding Name}"/>
                            <DataGridTextColumn Header="# Class" Width="55" Binding="{Binding NumClass}" CanUserSort="False"/>
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}">
                                <Setter Property="Foreground" Value="{Binding Code, Converter={StaticResource GrayingIfSelected}}"/>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>

                    <DataGrid Grid.Row="1" DockPanel.Dock="Bottom" x:Name="ClassTable"
                      Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding ClassCollection}" AutoGenerateColumns="False"
                      AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                      CanUserResizeColumns="False" CanUserAddRows="False" IsReadOnly="True" CanUserSortColumns="False">
                        <DataGrid.Resources>
                            <ContextMenu x:Key="RowMenu">
                                <MenuItem Header="View Detail" Click="ClassTableMenuItem_Click"/>
                            </ContextMenu>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="No." MaxWidth="30" Binding="{Binding Number}"/>
                            <DataGridTextColumn Header="Teacher" MaxWidth="55" Binding="{Binding Teacher}"/>
                            <DataGridTextColumn Header="Schedule" Width="*" Binding="{Binding DayTime}"/>
                            <DataGridTextColumn Header="Enroll" MinWidth="55" Binding="{Binding Enroll}"/>
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="{x:Type DataGridRow}">
                                <Setter Property="ContextMenu" Value="{StaticResource RowMenu}"/>
                                <EventSetter Event="MouseLeftButtonDown" Handler="DataGridRow_MouseLeftButtonDown"/>
                                <Setter Property="Foreground">
                                    <Setter.Value>
                                        <MultiBinding Converter="{StaticResource BlueIfHasNote}">
                                            <Binding Path="Code"/>
                                            <Binding Path="Number"/>
                                        </MultiBinding>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>
                </Grid>
            </DockPanel>

            <DataGrid x:Name="CurrentClassTable" Margin="10" Grid.Column="1" Grid.Row="1" AutoGenerateColumns="False"
                  Style="{DynamicResource LectureTableDataGridStyle}" ItemsSource="{Binding CurrentClassCollection}"
                  AlternatingRowBackground = "#F4F4F4" HeadersVisibility="Column" CanUserReorderColumns="False" CanUserResizeRows="False"
                  CanUserResizeColumns="False" CanUserAddRows="False" CanUserSortColumns="False" >
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="Pin"/>
                    <DataGridTextColumn Header="Name" Width="*" Binding="{Binding Name}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="No." Width="40" Binding="{Binding Number}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Teacher" Width="55" Binding="{Binding Teacher}" IsReadOnly="True"/>
                </DataGrid.Columns>
                <DataGrid.Resources>
                </DataGrid.Resources>
                <DataGrid.RowStyle>
                    <Style TargetType="{x:Type DataGridRow}">
                        <EventSetter Event="MouseRightButtonUp" Handler="CurrentClassTableRow_RightClick"/>
                        <EventSetter Event="KeyDown" Handler="CurrentClassTableRow_KeyDown"/>
                    </Style>
                </DataGrid.RowStyle>

            </DataGrid>

            <DockPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="2" Margin="10">
                <DockPanel DockPanel.Dock="Top" Margin="0,0,0,10">
                    <Label Content="Preference"/>
                    <ComboBox />
                </DockPanel>
                <Button DockPanel.Dock="Top" x:Name="BtnGenerate" Content="Generate" Margin="0,0,0,10"/>
                <DataGrid/>
            </DockPanel>

        </Grid>
    </DockPanel>
    
</Page>
